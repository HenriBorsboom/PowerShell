$Servers = @()
$Servers += ,('CAPPAYSQLM1')
$Servers += ,('CBAWPPRAPW016')
$Servers += ,('CBAWPPRAPW023')
$Servers += ,('CBAWPPRAPW029')
$Servers += ,('CBAWPPRAPW034')
$Servers += ,('CBAWPPRAPW036')
$Servers += ,('CBAWPPRAPW037')
$Servers += ,('CBAWPPRAPW038')
$Servers += ,('CBAWPPRAPW039')
$Servers += ,('CBAWPPRAPW059')
$Servers += ,('CBAWPPRAPW061')
$Servers += ,('CBAWPPRAPW063')
$Servers += ,('CBAWPPRAPW064')
$Servers += ,('CBAWPPRAPW076')
$Servers += ,('CBAWPPRAPW085')
$Servers += ,('CBAWPPRAPW086')
$Servers += ,('CBAWPPRAPW088')
$Servers += ,('CBAWPPRAPW089')
$Servers += ,('CBAWPPRAPW090')
$Servers += ,('CBAWPPRAPW101')
$Servers += ,('CBAWPPRAPW108')
$Servers += ,('CBAWPPRAPW115')
$Servers += ,('CBAWPPRAPW116')
$Servers += ,('CBAWPPRAPW186')
$Servers += ,('CBAWPPRAPW187')
$Servers += ,('CBAWPPRAPW188')
$Servers += ,('CBAWPPRAPW189')
$Servers += ,('CBAWPPRAPW190')
$Servers += ,('CBAWPPRAPW191')
$Servers += ,('CBAWPPRAPW192')
$Servers += ,('CBAWPPRAPW193')
$Servers += ,('CBAWPPRAPW281')
$Servers += ,('CBAWPPRAPW282')
$Servers += ,('CBAWPPRAPW295')
$Servers += ,('CBAWPPRAPW296')
$Servers += ,('CBAWPPRAPW297')
$Servers += ,('CBAWPPRAPW298')
$Servers += ,('CBAWPPRAPW299')
$Servers += ,('CBAWPPRAPW302')
$Servers += ,('CBAWPPRAPW303')
$Servers += ,('CBAWPPRAPW306')
$Servers += ,('CBAWPPRAPW307')
$Servers += ,('CBAWPPRDBW005')
$Servers += ,('CBAWPPRDBW007')
$Servers += ,('CBAWPPRDBW027')
$Servers += ,('CBAWPPRDBW028')
$Servers += ,('CBAWPPRDBW044')
$Servers += ,('CBCAPP1001')
$Servers += ,('CBDBPPRDBW007')
$Servers += ,('CBFP02')
$Servers += ,('CBSTBDMTCPRD')
$Servers += ,('CBVMPPRAPW004')
$Servers += ,('CBVMPPRAPW017')
$Servers += ,('CBVMPPRAPW019')
$Servers += ,('CBVMPPRAPW028')
$Servers += ,('CBWLDDRAPW165')
$Servers += ,('CBWLDDRAPW218')
$Servers += ,('CBWLPPRAPW054')
$Servers += ,('CBWLPPRAPW060')
$Servers += ,('CBWLPPRAPW131')
$Servers += ,('CBWLPPRAPW133')
$Servers += ,('CBWLPPRAPW150')
$Servers += ,('CBWLPPRAPW158')
$Servers += ,('CBWLPPRAPW244')
$Servers += ,('CBWLPPRAPW274')
$Servers += ,('CBWLPPRAPW360')
$Servers += ,('CBWLPPRAPW362')
$Servers += ,('CBWLPPRAPW387')
$Servers += ,('CBWLPPRAPW431')
$Servers += ,('CBWLPPRAPW432')
$Servers += ,('CBWLPPRAPW486')
$Servers += ,('CBWLPPRAPW495')
$Servers += ,('CBWLPPRAPW498')
$Servers += ,('CBWLPPRAPW502')
$Servers += ,('CBWLPPRAPW628')
$Servers += ,('CBWLPPRDBW004')
$Servers += ,('CBWLPPRDBW024')
$Servers += ,('CBWLPPRDBW032')
$Servers += ,('CBWLPPRDBW060')
$Servers += ,('CBWLPPRDBW166')
$Servers += ,('CBWLPPRDBW253')
$Servers += ,('CBWLPPRDBW255')
$Servers += ,('CBWLPPRDBW303')
$Servers += ,('CBWLPPRDBW319')
$Servers += ,('CBWLPPRDBW321')
$Servers += ,('CBWLPPRDBW334')
$Servers += ,('CBWLPPRDBW336')
$Servers += ,('CBWLPPRWFW021')
$Servers += ,('CBWLPPRWFW040')
$Servers += ,('CBWLPPRWFW088')
$Servers += ,('CBWLPPRWFW092')
$Servers += ,('CCPRDAPP048')
$Servers += ,('CCPRDAPP213')
$Servers += ,('CCPRDAPP244')
$Servers += ,('CCPRDAPP321')
$Servers += ,('CCPRDAPP324')
$Servers += ,('CCPRDDB025')
$Servers += ,('CCPRDDB093')
$Servers += ,('CCPRDWF066')
$Servers += ,('WPAMRISKACT101')
$Servers += ,('WPAMRISKACT102')
$Servers += ,('WPAMRISKSAM')
$Servers += ,('WPAMRISKUDM1')
$Servers += ,('WPCASHSUSS01')
$Servers += ,('WPCASHSUVV01')
$Servers += ,('WPCASHSUVVIM02')
$Servers += ,('WPCASHSUVVSDM')
$Servers += ,('WPCLDEDLBLOBS3')
$Servers += ,('WPCVCOOBPCCS1')
$Servers += ,('WPCVCOOBPCCS2')
$Servers += ,('WPCVCOOBPCCS3')
$Servers += ,('WPCVCOOBSAREP1')
$Servers += ,('WPCVCOOBSAREP2')
$Servers += ,('WPCVCOOBSAS1')
$Servers += ,('WPCVCOOBSAS2')
$Servers += ,('WPCVCOOBSAS3')
$Servers += ,('WPCVCOOBSAS4')
$Servers += ,('WPCVCOOBSAS5')
$Servers += ,('WPCVCOOBSAS6')
$Servers += ,('WPCVCOOBSAS7')
$Servers += ,('WPCVCOOBSAS8')
$Servers += ,('WPCVCOOBSAS9')
$Servers += ,('WPDATATRNMSGW01')
$Servers += ,('WPINSURAPRFPD1')
$Servers += ,('WPINSURAPRFPD2')
$Servers += ,('WPINSURAPRFPD4')
$Servers += ,('WPISAENGAGPM01')
$Servers += ,('WPPAYHCPWPTX01')
$Servers += ,('WPPAYSVCWPEFT1')
$Servers += ,('WPPENTSTCTR702')
$Servers += ,('WPPENTSTCTR703')
$Servers += ,('WPPLIPLAINSCLA')
$Servers += ,('WPPLRDOCSKYQR2')
$Servers += ,('WPPLRDOCWF1')
$Servers += ,('WPPLRDOCWF3')
$Servers += ,('WPPLSPAYDCDP08')
$Servers += ,('WPPLSPAYDCDP09')
$Servers += ,('WPPLSPAYEFTP1')
$Servers += ,('WPTSCBRBSJ01')
$Servers += ,('WPTSCBRBSSRN01')
$Servers += ,('WPTSCBRBSSRN02')
$Servers += ,('WPTSCBRBSSWR03')
$Servers += ,('WPWSPENGIDES01')
$Servers += ,('WPWSPENGLDCM01')
$Servers += ,('WPWSPENGMVE01')
$Servers += ,('WPWSPENGUOMEGA')
$Servers += ,('WPWSPENGUPROS1')


$Details = @()
#D:\Apps\Captools\Scripts\ChangeActiveHours
For ($i = 0; $i -lt $Servers.Count; $i ++) {
    Write-Host (($i + 1).ToString() + '/' + $Servers.Count.ToString() + ' - Processing ' + $Servers[$i] + ' - ') -NoNewline
    Try {
        If (Test-Connection $Servers[$i] -Count 1 -Quiet) {
            If (Test-Path ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts')) {
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts\ChangeActiveHours') -ItemType Directory
            }
            ElseIf (Test-Path ('\\' + $Servers[$i] + '\D$\Apps\Captools')) {
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts\ChangeActiveHours') -ItemType Directory
            }
            ElseIf (Test-Path ('\\' + $Servers[$i] + '\D$\Apps\')) {
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Scripts\ChangeActiveHours') -ItemType Directory
            }
            ElseIf (Test-Path ('\\' + $Servers[$i] + '\D$')) {
                New-Item ('\\' + $Servers[$i] + '\D$\Apps') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts') -ItemType Directory
                New-Item ('\\' + $Servers[$i] + '\D$\Apps\Captools\Scripts\ChangeActiveHours') -ItemType Directory
            }

            Copy-Item D:\Temp\ActiveHours\* -Destination ('\\' + $Servers[$i] + '\d$\Apps\Captools\Scripts\ChangeActiveHours')
            $ScriptBlock = {
                #Expand-Archive -Path '\\cbfp01\temp\henri\Change Active Hours.zip' -DestinationPath D:\Apps\Captools\Scripts\ChangeActiveHours
                Set-ExecutionPolicy -ExecutionPolicy Bypass -Force
                Register-ScheduledTask -Xml ([String] (Get-Content 'D:\Apps\Captools\Scripts\ChangeActiveHours\Change Active Hours - 03-15.xml')) -TaskName 'Change Active Hours - 03-15'
                Register-ScheduledTask -Xml ([String] (Get-Content 'D:\Apps\Captools\Scripts\ChangeActiveHours\Change Active Hours - 06-18.xml')) -TaskName 'Change Active Hours - 06-18'
                Register-ScheduledTask -Xml ([String] (Get-Content 'D:\Apps\Captools\Scripts\ChangeActiveHours\Change Active Hours - 15-03.xml')) -TaskName 'Change Active Hours - 15-03'
                Register-ScheduledTask -Xml ([String] (Get-Content 'D:\Apps\Captools\Scripts\ChangeActiveHours\Change Active Hours - 18-06.xml')) -TaskName 'Change Active Hours - 18-15'
                Start-ScheduledTask -TaskName 'Change Active Hours - 03-15'
                get-winevent -LogName Application -MaxEvents 1 | Where-Object {$_.ID -eq 1 -and $_.ProviderName -eq 'ChangeActiveHours'}
            }

            Invoke-Command -ComputerName $Servers[$i] -ScriptBlock $ScriptBlock

            Write-Host "Complete" -ForegroundColor Green
            $Details += ,(New-Object -TypeName psobject -Property @{
                Server = $Servers[$i]
                Status = 'Done'
            })
        }
        Else {
            Write-Host "Offline" -ForegroundColor Red
            $Details += ,(New-Object -TypeName psobject -Property @{
                Server = $Servers[$i]
                Status = 'Offline'
            })
        }
    }
    Catch {
        Write-Host $_ -ForegroundColor Red
        $Details += ,(New-Object -TypeName psobject -Property @{
                Server = $Servers[$i]
                Status = 'Error'
            })
    }
}
$Details | Out-GridView